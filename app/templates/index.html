{% extends "base.html" %}
{% block content %}
    <form id="filters"
            hx-get="/search"
            hx-target="#results"
            hx-swap="outerHTML"
            hx-trigger="load, change delay:200ms">
        <input type="hidden" name="lat" id="lat" value="32.7767">
        <input type="hidden" name="lng" id="lng" value="-96.7970">

        <label>Radius (km)
            <input type="number" step="0.1" name="radius_km" value="0">
        </label>>

        <label>Menu terms (comma-separated)
            <input type="text" name="terms" placeholder="shawarma,tacos">
        </label>

        <label>Prices
            <select name="prices" multiple>
                <option value="1">$</option>
                <option value="2">$$</option>
                <option value="3">$$$</option>
            </select>
        </label>

        <label><input type="checkbox" name="halal" value="true">Halal Only</label>

        <label>Busyness
            <select name="busy" multiple>
                <option>Low</option><option>Moderate</option><option>High</option>
            </select>
        </label>
    </form>

    <div id="map" class="h-80"></div>
    <div id="results"></div>
{% endblock %}

<button type="button" id="use-location">Use my location</button>
<script>
    document.getElementById('use-location').onclick = () => {
        if (!navigator.geolocation) return alert("Geolocation not supported");
        navigator.geolocation.getCurrentPosition(pos => {
            const { latitude, longitude } = pos.coords;
            document.getElementById('lat').value = latitude.toFixed(6);
            document.getElementById('lng').value = longitude.toFixed(6);
            document.getElementById('filters').dispatchEvent(new Event('change', {bubbles:true}));
            localStorage.setItem('ff_loc', JSON.stringify({lat: latitude, lng: longitude}));
        });
    };

    //prefull last location
    const saved= localStorage.getItem('ff_loc');
    if (saved) {
        const {lat,lng} = JSON.parse(saved);
        lat && (document.getElementById('lat').value = lat);
        lng && (document.getElementById('lng').value = lng);
    }
</script>